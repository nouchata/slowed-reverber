"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[53],{6578:function(e,t,n){n.d(t,{Z:function(){return _}});var r=n(828),o=n(5893),a=n(5152),s=n.n(a),i=n(7294),u=function(e){return(0,o.jsxs)("div",{className:"".concat(e.className," flex flex-row box-border select-none"),children:[(0,o.jsxs)("div",{className:"flex-[0_1_100%] flex flex-col flex-nowrap justify-center box-border p-4 overflow-hidden",children:[(0,o.jsx)("h1",{className:"text-2xl font-bold m-0 p-0 text-ellipsis overflow-hidden flex-[0_0_auto] text-white opacity-90",children:e.title}),e.description&&(0,o.jsx)("h3",{className:"text-xs italic text-ellipsis overflow-hidden flex-[0_0_auto]",children:e.description})]}),e.children&&e.children]})},c=n(6038),l=n(5490),d=function(e){var t=(0,i.useRef)(c.ZP.timeline({paused:!0})),n=(0,i.useRef)(null),r=(0,i.useRef)(null),a=(0,i.useRef)(null);return(0,l.Z)((function(){var e=c.ZP.context((function(){t.current.to(n.current,{duration:.5,ease:"power4.out",rotation:180},0).to(r.current,{duration:.5,fill:"white",ease:"none.none"},0).to(a.current,{duration:.5,stroke:"black",ease:"none.none"},0)}));return function(){return e.revert()}}),[]),(0,i.useEffect)((function(){n.current&&e.isSelected&&t.current.play(),n.current&&!e.isSelected&&t.current.reverse()}),[e.isSelected,n.current]),(0,o.jsxs)("svg",{ref:n,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round","aria-labelledby":"title",className:e.className,children:[(0,o.jsx)("title",{children:"Settings"}),(0,o.jsx)("path",{ref:r,d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}),(0,o.jsx)("circle",{ref:a,cx:"12",cy:"12",r:"3"})]})},f=n(1799),h=n(9396),p=function(e){var t=(0,i.useRef)(c.ZP.timeline({paused:!0})),n=(0,i.useRef)(null);return(0,l.Z)((function(){var e=c.ZP.context((function(){t.current.to(n.current,{css:{strokeWidth:"*=2"},duration:.3},0).to("circle",{attr:{fill:"white"},duration:.3},0)}),n);return function(){return e.revert()}}),[]),(0,i.useEffect)((function(){!e.isSelected&&t.current.progress()&&t.current.reverse(),e.isSelected&&!t.current.progress()&&t.current.play()}),[e.isSelected]),(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,style:(0,h.Z)((0,f.Z)({},e.style),{strokeWidth:"1.5"}),ref:n,"aria-labelledby":"title",children:[(0,o.jsx)("title",{children:"Musics"}),(0,o.jsx)("path",{d:"M9 18V5l12-2v13"}),(0,o.jsx)("circle",{cx:"6",cy:"18",r:"3",fill:"none"}),(0,o.jsx)("circle",{cx:"18",cy:"16",r:"3",fill:"none"})]})},v=n(1108),b=function(e){var t=(0,i.useContext)(v.R).appData.router;return(0,o.jsxs)("nav",{className:"".concat(e.className," flex flex-row h-full box-border"),children:[(0,o.jsx)("button",{className:"flex-1 flex flex-col py-2 box-border overflow-hidden items-center h-full w-full",onClick:function(){"Songs"!==e.selectedItem&&t.push("/app/songs")},children:(0,o.jsx)(p,{isSelected:"Songs"===e.selectedItem,className:"flex-[1_0_0] stroke-white antialiased"})}),(0,o.jsx)("button",{className:"flex-1 flex flex-col py-2 box-border overflow-hidden items-center h-full w-full",onClick:function(){"Settings"!==e.selectedItem&&t.push("/app/settings")},children:(0,o.jsx)(d,{isSelected:"Settings"===e.selectedItem,className:"flex-[1_0_0] stroke-white antialiased"})})]})},g=n(3145),m=n.n(g),x=n(7299),y=function(e){var t=(0,i.useRef)(null),n=(0,i.useRef)(null),r=(0,i.useRef)(c.ZP.timeline({paused:!0}));return(0,l.Z)((function(){var e=c.ZP.context((function(){r.current.to(t.current,{opacity:0,duration:.2},0).to(n.current,{opacity:1,duration:.2},0)}));return function(){return e.revert()}}),[]),(0,i.useEffect)((function(){e.isPaused?r.current.reverse():r.current.play()}),[e.isPaused]),(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[(0,o.jsx)("title",{children:"Press to ".concat(e.isPaused?"play":"pause"," the audio")}),(0,o.jsx)("g",{ref:t,children:(0,o.jsx)("polygon",{points:"5 3 19 12 5 21 5 3"})}),(0,o.jsxs)("g",{ref:n,className:"opacity-0",children:[(0,o.jsx)("rect",{x:"6",y:"4",width:"4",height:"16"}),(0,o.jsx)("rect",{x:"14",y:"4",width:"4",height:"16"})]})]})},w=n(7568),S=n(655),I=n(5835),D=function(e){var t=(0,I.Z)(),n=(0,i.useRef)(null),r=(0,i.useRef)(null),a=(0,i.useRef)(null),s=(0,i.useContext)(x.B),u=s.soundsManager,c=s.isCurrentSoundReady;return(0,i.useEffect)((function(){a.current.isDragging=!1,a.current.onMouseUpCallback=function(e){this.isDragging&&(this.setNewPercentage(e.clientX,!1,!0),this.isDragging=!1)}.bind(a.current),a.current.onMouseMoveCallback=function(e){this.isDragging&&this.setNewPercentage(e.clientX,!1,!1)}.bind(a.current);var e=a.current.onMouseUpCallback,t=a.current.onMouseMoveCallback;return a.current.underlineRef=n.current,a.current.circleRef=r.current,window.addEventListener("mouseup",a.current.onMouseUpCallback),window.addEventListener("mousemove",a.current.onMouseMoveCallback),function(){window.removeEventListener("mouseup",e),window.removeEventListener("mousemove",t)}}),[]),(0,i.useEffect)((function(){a.current&&(a.current.boundingClientRect=a.current.getBoundingClientRect())}),[t,a.current]),(0,i.useEffect)((function(){var e=!0,t=function(){var n=(0,w.Z)((function(){return(0,S.__generator)(this,(function(n){switch(n.label){case 0:return e&&c?(a.current&&!a.current.isDragging&&a.current.setNewPercentage&&a.current.setNewPercentage(100*u.getCurrentPercentage(),!0,!1),[4,new Promise((function(e){setTimeout((function(){e(1)}),500)}))]):[3,2];case 1:n.sent(),t(),n.label=2;case 2:return[2]}}))}));return function(){return n.apply(this,arguments)}}();return t(),a.current.setNewPercentage=function(e,t,n){var r=t?Math.min(Math.max(0,e),100):Math.min(Math.max(0,100*(e-a.current.boundingClientRect.x)/(a.current.boundingClientRect.x+a.current.boundingClientRect.width-a.current.boundingClientRect.x)),100);a.current.circleRef.setAttribute("cx","".concat(r,"%")),a.current.underlineRef.setAttribute("x2","".concat(r,"%")),c&&n&&u.updateAudioPosition(r)},function(){e=!1}}),[c]),(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"cursor-pointer overflow-visible ".concat(e.className),stroke:"currentColor",strokeWidth:"1",strokeLinecap:"round","aria-labelledby":"title",ref:a,onMouseDown:function(){a.current.isDragging=!0},onTouchStartCapture:function(){a.current.isDragging=!0},onTouchMoveCapture:function(e){var t;null===(t=a.current)||void 0===t||t.setNewPercentage(e.targetTouches.item(0).clientX,!1,!1)},onTouchEndCapture:function(e){var t;null===(t=a.current)||void 0===t||t.setNewPercentage(e.changedTouches.item(0).clientX,!1,!0),a.current.isDragging=!1},children:[(0,o.jsx)("title",{children:"Current progress of the playback"}),(0,o.jsx)("line",{x1:"0%",x2:"100%",y1:"50%",y2:"50%",fill:"none"}),(0,o.jsx)("line",{ref:n,x1:"0%",x2:"0%",y1:"50%",y2:"50%",fill:"none",strokeWidth:"3"}),(0,o.jsx)("circle",{ref:r,cy:"50%",cx:"0%",r:"7",fill:"currentColor"})]})},C=function(e){var t=(0,i.useContext)(x.B),n=t.isCurrentSoundReady,r=t.isSoundsManagerInit,a=t.soundsManager,s=t.playState,u=t.currentSound,c=(0,i.useContext)(v.R).setAppData,l=(0,i.useState)(["--","--"]),d=l[0],f=l[1];return(0,i.useEffect)((function(){var t=a;return e.cutAudio&&(null===t||void 0===t||t.cutAudio()),function(){return null===t||void 0===t?void 0:t.cutAudio()}}),[e.cutAudio,r]),(0,i.useEffect)((function(){var e,t=((null===u||void 0===u?void 0:u.soundBufferDuration)||0)/((null===u||void 0===u||null===(e=u.soundInfoData)||void 0===e?void 0:e.speedValue)||1),n=Math.floor(t/60),r=Math.floor(t-60*n);Number.isNaN(n)||Number.isNaN(r)?f(["--","--"]):f([String(n).padStart(2,"0"),String(r).padStart(2,"0")])}),[u]),(0,o.jsxs)("div",{style:e.style,className:"text-white flex flex-row flex-nowrap rounded select-none min-w-[250px] ".concat(e.className),children:[(0,o.jsx)("button",{onClick:function(){try{s?null===a||void 0===a||a.pause():null===a||void 0===a||a.play()}catch(e){c({error:{type:"normal",value:e.message}})}},className:"flex-[0_0_80px] flex justify-center items-center box-border py-2",children:(0,o.jsx)(y,{className:"w-full h-full",isPaused:!s})}),(0,o.jsx)("div",{className:"flex-1 px-[5%]",children:(0,o.jsx)(D,{className:"w-full h-full"})}),(0,o.jsxs)("span",{id:"player-sound-total-time",title:"Duration of the edited song",className:"flex-[0_0_80px] flex justify-center items-center",children:[d[0],":",d[1]]}),!(n&&r)&&(0,o.jsx)("div",{className:"absolute w-full h-full rounded opacity-80 bg-app-element-disabled"})]})},k=n(3917),P=function(){var e=(0,i.useContext)(v.R).appData,t=e.router,a=e.oldRoutes,u=(0,i.useContext)(v.R),d=u.appData,f=u.setAppData,h=(0,i.useContext)(x.B),p=h.isSoundsManagerInit,b=h.isCurrentSoundReady,g=(0,i.useRef)(null),y=(0,i.useRef)(c.ZP.timeline({paused:!0})),w=(0,i.useRef)(null),S=(0,i.useRef)(c.ZP.timeline({paused:!0})),I=(0,i.useRef)(null),D=(0,i.useState)(void 0),P=D[0],T=D[1],j=(0,i.useState)(""),E=j[0],A=j[1],_=(0,i.useRef)(void 0);return(0,l.Z)((function(){var e,n=c.ZP.context((function(){c.ZP.registerPlugin(m()),y.current.set(g.current,{css:{visibility:"visible"}}).to(g.current,{backgroundColor:"rgba(0,0,0,0.5)",duration:.3}),S.current.from(w.current,{y:"100%",duration:.3},0).to(w.current,{opacity:1,duration:.3,onComplete:function(){var n;n=(0,r.Z)(m().create(w.current,{cursor:"grab",activeCursor:"grabbing",trigger:I.current,type:"y",dragResistance:.05,liveSnap:function(e){return e>0?e:0},onRelease:function(n){n.pageY>=300?(null===e||void 0===e||e.kill(),e=void 0,S.current.invalidate(),t.push("/app/songs")):(null===e||void 0===e||e.disable(),c.ZP.to(w.current,{y:"0",duration:.2}).then((function(){return null===e||void 0===e?void 0:e.enable()})))}}),1),e=n[0]},onReverseComplete:function(){null===e||void 0===e||e.kill(),e=void 0}},0)}));return function(){null===e||void 0===e||e.kill(),n.revert()}}),[]),(0,i.useEffect)((function(){if(t.query.md){if(y.current.play(),c.ZP.set(w.current,{y:0}).then((function(){return S.current.invalidate().play()})),!p)return;"/app/songs"===t.pathname&&"addSong"===t.query.md||"/app/songs"===t.pathname&&"editSong"===t.query.md?T(s()((function(){return n.e(933).then(n.bind(n,3933))}),{loadableGenerated:{webpack:function(){return[3933]}},suspense:!0})):"/app/songs"===t.pathname&&"viewSong"===t.query.md?T(s()((function(){return n.e(681).then(n.bind(n,2681))}),{loadableGenerated:{webpack:function(){return[2681]}},suspense:!0})):"/app/songs"===t.pathname&&"editVisual"===t.query.md?T(s()((function(){return Promise.all([n.e(522),n.e(842)]).then(n.bind(n,577))}),{loadableGenerated:{webpack:function(){return[577]}},suspense:!0})):"/app/songs"===t.pathname&&"exportMedia"===t.query.md?T(s()((function(){return n.e(399).then(n.bind(n,4399))}),{loadableGenerated:{webpack:function(){return[4399]}},suspense:!0})):a.length?t.back():t.push(t.pathname||"/app/songs")}else y.current.reverse(),S.current.reverse(),T(void 0)}),[t.query.md,p]),(0,i.useEffect)((function(){"normal"===(null===d||void 0===d?void 0:d.error.type)?(_.current&&clearTimeout(_.current),_.current=setTimeout((function(){return f({error:{type:"none",value:""}})}),4e3)):_.current=void 0}),[null===d||void 0===d?void 0:d.error]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{id:"app-display-error-modal",className:"absolute w-4/5 top-6 left-[10%] text-white bg-red-600 cursor-pointer select-none break-words box-border p-3 rounded drop-shadow-md transition-all -translate-y-20 z-40",style:"normal"===(null===d||void 0===d?void 0:d.error.type)?{transform:"none"}:{},onClick:function(){clearTimeout(_.current),_.current=void 0,f({error:{type:"none",value:""}})},children:"normal"===(null===d||void 0===d?void 0:d.error.type)?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("strong",{children:"Error:"})," ",d.error.value]}):(0,o.jsx)(o.Fragment,{})}),d&&d.customModal&&"critical"!==d.error.type&&(0,o.jsx)("div",{id:"app-display-custom-modal",className:"absolute w-full h-full bg-[rgba(0,0,0,0.5)] z-50 flex justify-center items-center",children:d.customModal}),((null===d||void 0===d?void 0:d.mediumModalText)||"critical"===(null===d||void 0===d?void 0:d.error.type))&&(0,o.jsx)("div",{id:"app-display-medium-modal",className:"absolute w-full h-full bg-[rgba(0,0,0,0.5)] z-50 flex justify-center items-center",children:(0,o.jsxs)("div",{className:"".concat("critical"===d.error.type?"bg-app-primary-color":"bg-app-modal-xl-lighter"," flex-[0_0_320px] text-white box-border px-2 drop-shadow-lg rounded flex flex-col"),children:["critical"===d.error.type&&(0,o.jsx)("h1",{className:"w-full text-center pt-4 font-bold select-none",children:"Critical error"}),(0,o.jsx)("p",{className:"w-full text-center py-4 break-words",children:"critical"===d.error.type?d.error.value:d.mediumModalText}),d.mediumModalText&&"critical"!==d.error.type&&(0,o.jsx)("button",{className:"w-full py-2 border-t-2 border-t-app-modal-xl-background font-extrabold",onClick:function(){f({mediumModalText:""})},children:"Close"})]})}),(0,o.jsxs)("div",{id:"app-display-xl-container",className:"absolute invisible w-full h-full bg-[rgba(0,0,0,0)] z-30",ref:g,children:[(0,o.jsxs)("div",{id:"app-display-xl-modal",className:"absolute opacity-0 bottom-0 w-full h-[90%] rounded-t-lg bg-app-modal-xl-background overflow-visible",ref:w,children:[(0,o.jsx)("div",{className:"absolute w-full h-16 top-[-40px] flex justify-center items-end z-10",id:"app-display-xl-modal-drag-down",ref:I,children:(0,o.jsxs)("svg",{viewBox:"0 0 50 15",xmlns:"http://www.w3.org/2000/svg",className:"stroke-white overflow-visible h-6",fill:"currentColor",strokeWidth:"3",strokeLinecap:"round","aria-labelledby":"title",children:[(0,o.jsx)("title",{children:"Drag down to close the modal"}),(0,o.jsx)("line",{y2:"7.5",x2:"45",y1:"7.5",x1:"5",fill:"none"})]})}),(0,o.jsxs)("div",{id:"add-display-xl-modal-container",className:"relative w-full h-full box-border pt-[20px] overflow-hidden",children:[p&&P?(0,o.jsx)(i.Suspense,{fallback:(0,o.jsx)(k.Z,{}),children:(0,o.jsx)(P,{setPlayerExtraClasses:A})}):(0,o.jsx)(k.Z,{}),(0,o.jsx)(C,{style:{transform:b?"none":void 0},className:"absolute bottom-5 w-[90%] left-[5%] h-12 bg-app-modal-xl-lighter drop-shadow-lg translate-y-32 transition-all z-10 ".concat(E),cutAudio:!t.query.md})]})]}),(0,o.jsx)("div",{})]})]})},T=function(e){var t=(0,i.useRef)(null),r=(0,I.Z)(),a=(0,i.useContext)(v.R).appData,s=(0,i.useState)([]),u=s[0],c=s[1];return(0,i.useEffect)((function(){(0,w.Z)((function(){var e;return(0,S.__generator)(this,(function(t){switch(t.label){case 0:return[4,n.e(598).then(n.bind(n,8598))];case 1:return e=t.sent().default,c(e.map((function(e){var t=new Image;return t.src=e,t}))),[2]}}))}))()}),[]),(0,i.useEffect)((function(){var e,n,o,a=!0,s=null===(e=t.current)||void 0===e?void 0:e.getContext("2d"),i=null===(n=u[0])||void 0===n?void 0:n.width,c=null===(o=u[0])||void 0===o?void 0:o.height,l=0,d=function(){var e=(0,w.Z)((function(){var e,t;return(0,S.__generator)(this,(function(n){switch(n.label){case 0:if(!(a&&s&&r.width&&r.height))return[3,2];for(l===u.length&&(l=0),e=0;e<r.width;e+=i)for(t=0;t<r.height;t+=c)s.drawImage(u[l],e,t);return l+=1,[4,new Promise((function(e){setTimeout((function(){e(1)}),100)}))];case 1:n.sent(),d(),n.label=2;case 2:return[2]}}))}));return function(){return e.apply(this,arguments)}}();return u.length&&d(),function(){a=!1}}),[r,u]),(0,i.useEffect)((function(){t.current&&(u.length?a.fileDragAndDrop?t.current.style.opacity="0.5":t.current.style.opacity="1":t.current.style.opacity="0")}),[a.fileDragAndDrop,u]),(0,o.jsx)("canvas",{style:e.style,className:"opacity-0 transition-opacity ".concat(e.className),ref:t,width:r.width,height:r.height,children:e.children})},j=n(1446),E=function(e){e.preventDefault(),e.stopPropagation()},A=function(e){var t=(0,i.useContext)(v.R).appData.router,n=(0,i.useContext)(v.R).setAppData,a=(0,r.Z)((0,j.Z)(),1)[0],s=(0,I.Z)().width,c=(0,i.useRef)(0);return(0,o.jsx)(x.Z,{children:(0,o.jsxs)("div",{id:"app-container",style:{backgroundColor:"black"===a.backgroundColor?"rgb(0,0,0)":"rgb(15,23,42)"},className:"relative flex w-full h-full justify-center bg-black",onDragEnter:function(e){E(e),c.current+=1,"/app/songs/"===t.asPath&&t.push({pathname:"/app/songs",query:{md:"addSong"}}),n({fileDragAndDrop:!0})},onDragLeave:function(e){E(e),c.current-=1,c.current||n({fileDragAndDrop:!1})},onDrop:function(e){E(e),n({fileDragAndDrop:!1})},onDragOver:E,onDrag:E,onDragEnd:E,onDragStart:E,children:[s&&s>600&&a.showStaticCanvas&&(0,o.jsx)(T,{className:"absolute top-0 left-0 w-full h-full"}),(0,o.jsxs)("div",{id:"app-display",className:"relative overflow-hidden h-full flex-[0_1_600px] bg-app-display-background drop-shadow-2xl flex flex-col flex-nowrap",children:[(0,o.jsx)(P,{}),(0,o.jsx)(u,{title:e.tabName||"",className:"bg-black h-[70px] block absolute top-0 w-full drop-shadow z-20"}),(0,o.jsx)("div",{className:"relative h-0 flex-1 pt-[70px] overflow-auto",children:e.children&&e.children}),(0,o.jsx)(b,{className:"bg-black border-t border-t-[rgba(255,255,255,0.1)] flex-[0_0_50px] drop-shadow z-20 shadow-inner",selectedItem:e.tabName||"Songs"})]})]})})},_=s()((function(){return Promise.resolve(A)}),{ssr:!1})},8476:function(e,t,n){n.d(t,{h:function(){return c}});var r=n(5893),o=n(9008),a=n.n(o),s=n(2962),i=n(7294),u=n(1108),c=function(e){var t=(0,i.useContext)(u.R).appData.router;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(a(),{children:[(0,r.jsx)("meta",{charSet:"UTF-8"},"charset"),(0,r.jsx)("meta",{name:"viewport",content:"width=device-width,initial-scale=1"},"viewport"),(0,r.jsx)("link",{rel:"apple-touch-icon",href:"".concat(t.basePath,"/apple-touch-icon.png")},"apple"),(0,r.jsx)("link",{rel:"icon",type:"image/png",sizes:"32x32",href:"".concat(t.basePath,"/favicon-32x32.png")},"icon32"),(0,r.jsx)("link",{rel:"icon",type:"image/png",sizes:"16x16",href:"".concat(t.basePath,"/favicon-16x16.png")},"icon16"),(0,r.jsx)("link",{rel:"icon",href:"".concat(t.basePath,"/favicon.ico")},"favicon"),e.children]}),(0,r.jsx)(s.PB,{title:e.title,description:e.description,canonical:e.canonical,openGraph:{title:e.title,description:e.description,url:e.canonical,locale:"en",site_name:"Slowed Reverber"}})]})}},3917:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(5893),o=function(e){return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round","aria-labelledby":"title",viewBox:"0 0 42.8 72.2",className:"".concat(e.className),style:e.style,children:[(0,r.jsx)("title",{children:"Please wait ..."}),(0,r.jsxs)("g",{id:"loading-logo-letters",children:[(0,r.jsxs)("g",{children:[(0,r.jsx)("path",{pathLength:"10",style:{strokeDashoffset:0,strokeDasharray:1},id:"loading-logo-s",className:"animate-loading-logo-spin",d:"M0.5,47h6.9v15c0,0.7,0.3,1.4,0.8,1.9c0,0,0,0,0,0 c0.3,0.3,0.6,0.5,1,0.6c0.3,0.1,0.6,0.2,0.9,0.2c0.7,0,1.4-0.3,1.9-0.8c0,0,0,0,0,0c0.3-0.3,0.5-0.6,0.6-1c0.1-0.3,0.2-0.6,0.2-0.9 v-7.3c0-0.6,0-1.2,0-1.8c0-1.8-0.2-3.1-0.3-3.8c-0.2-1-1.1-2.8-2.6-5.5l-0.3-0.7v-0.1c-0.6-1.2-1.2-2.4-1.8-3.5 c-1-1.8-1.9-3.5-2.7-5l-0.5-1L3.5,31l-0.4-0.7c-0.3-0.5-0.5-1.1-0.8-1.6c-0.7-1.4-1.2-2.5-1.4-3.3c0-0.1-0.1-0.3-0.1-0.4 c-0.2-0.8-0.3-2.2-0.3-4.4c0-0.5,0-1,0-1.5v-1.2v-3.8L0.6,10c0-2.5,1-4.8,2.7-6.6c0,0,0.1-0.1,0.1-0.1c1.9-1.9,4.1-2.8,6.7-2.8 c2.5,0,4.9,0.9,6.7,2.7c0,0,0.1,0.1,0.1,0.1c0.8,0.8,1.5,1.8,2,2.8c0.6,1.2,0.9,2.5,0.9,3.9v15.2h-6.9V10.1c0-0.5-0.2-1.1-0.5-1.5 c-0.1-0.1-0.2-0.2-0.3-0.3c-0.3-0.3-0.6-0.5-1-0.6c-0.3-0.1-0.6-0.2-0.9-0.2c-0.7,0-1.4,0.2-1.9,0.8s-0.8,1.1-0.8,1.9v7.3 c0,0.5,0,1,0,1.5c0,1.2,0,2.1,0.1,2.7c0,0.1,0,0.2,0,0.3c0.1,0.6,0.2,1.2,0.4,1.8c0.1,0.3,0.2,0.5,0.3,0.7c0.3,0.8,0.9,2.1,1.8,3.8 c0.1,0.2,0.2,0.3,0.2,0.5l0.3,0.7v0.1c0,0,0,0,0,0.1c0.1,0.1,0.2,0.4,0.5,0.7l1.2,2.4c1.5,2.7,3,5.6,4.4,8.5l0.1,0.1 c0.3,0.6,0.6,1.2,0.9,1.8c0.9,1.9,1.5,3.3,1.7,4c0.1,0.3,0.1,0.6,0.2,0.8c0.1,0.9,0.2,2.3,0.2,4c0,0.2,0,0.4,0,0.6V62 c0,1.3-0.2,2.5-0.8,3.7c-0.5,1.2-1.2,2.3-2.2,3.2c-1.8,1.8-4.2,2.8-6.7,2.8c0,0-0.1,0-0.1,0c-1.3,0-2.5-0.2-3.7-0.8 s-2.2-1.2-3.1-2.1c-1.8-1.8-2.8-4.2-2.8-6.7c0,0,0-0.1,0-0.1V47z"}),(0,r.jsx)("path",{id:"loading-logo-s-shape-beneath",className:"opacity-30",d:"M0.5,47h6.9v15c0,0.7,0.3,1.4,0.8,1.9c0,0,0,0,0,0 c0.3,0.3,0.6,0.5,1,0.6c0.3,0.1,0.6,0.2,0.9,0.2c0.7,0,1.4-0.3,1.9-0.8c0,0,0,0,0,0c0.3-0.3,0.5-0.6,0.6-1c0.1-0.3,0.2-0.6,0.2-0.9 v-7.3c0-0.6,0-1.2,0-1.8c0-1.8-0.2-3.1-0.3-3.8c-0.2-1-1.1-2.8-2.6-5.5l-0.3-0.7v-0.1c-0.6-1.2-1.2-2.4-1.8-3.5 c-1-1.8-1.9-3.5-2.7-5l-0.5-1L3.5,31l-0.4-0.7c-0.3-0.5-0.5-1.1-0.8-1.6c-0.7-1.4-1.2-2.5-1.4-3.3c0-0.1-0.1-0.3-0.1-0.4 c-0.2-0.8-0.3-2.2-0.3-4.4c0-0.5,0-1,0-1.5v-1.2v-3.8L0.6,10c0-2.5,1-4.8,2.7-6.6c0,0,0.1-0.1,0.1-0.1c1.9-1.9,4.1-2.8,6.7-2.8 c2.5,0,4.9,0.9,6.7,2.7c0,0,0.1,0.1,0.1,0.1c0.8,0.8,1.5,1.8,2,2.8c0.6,1.2,0.9,2.5,0.9,3.9v15.2h-6.9V10.1c0-0.5-0.2-1.1-0.5-1.5 c-0.1-0.1-0.2-0.2-0.3-0.3c-0.3-0.3-0.6-0.5-1-0.6c-0.3-0.1-0.6-0.2-0.9-0.2c-0.7,0-1.4,0.2-1.9,0.8s-0.8,1.1-0.8,1.9v7.3 c0,0.5,0,1,0,1.5c0,1.2,0,2.1,0.1,2.7c0,0.1,0,0.2,0,0.3c0.1,0.6,0.2,1.2,0.4,1.8c0.1,0.3,0.2,0.5,0.3,0.7c0.3,0.8,0.9,2.1,1.8,3.8 c0.1,0.2,0.2,0.3,0.2,0.5l0.3,0.7v0.1c0,0,0,0,0,0.1c0.1,0.1,0.2,0.4,0.5,0.7l1.2,2.4c1.5,2.7,3,5.6,4.4,8.5l0.1,0.1 c0.3,0.6,0.6,1.2,0.9,1.8c0.9,1.9,1.5,3.3,1.7,4c0.1,0.3,0.1,0.6,0.2,0.8c0.1,0.9,0.2,2.3,0.2,4c0,0.2,0,0.4,0,0.6V62 c0,1.3-0.2,2.5-0.8,3.7c-0.5,1.2-1.2,2.3-2.2,3.2c-1.8,1.8-4.2,2.8-6.7,2.8c0,0-0.1,0-0.1,0c-1.3,0-2.5-0.2-3.7-0.8 s-2.2-1.2-3.1-2.1c-1.8-1.8-2.8-4.2-2.8-6.7c0,0,0-0.1,0-0.1V47z"})]}),(0,r.jsxs)("g",{children:[(0,r.jsx)("path",{pathLength:"10",style:{strokeDashoffset:0,strokeDasharray:1},id:"loading-logo-r",className:"animate-loading-logo-spin",d:"M34.8,70.7V41.5c0-0.3,0-0.6-0.1-0.8c-0.1-0.3-0.3-0.6-0.5-0.8 c-0.4-0.4-0.9-0.6-1.5-0.6c-0.1,0-0.1,0-0.2,0h-2.2v31.5h-7.5V1.1h11.7c2.1,0,4,0.8,5.5,2.2c0,0,0,0,0,0c1.5,1.4,2.3,3.3,2.3,5.3 c0,0,0,0.1,0,0.1v20.7c0,2.1-0.7,4.1-2,5.8l-0.1,0.2l0.1,0.1c1.3,1.7,2,3.7,2,5.9v29.2H34.8z M30.8,31.2V9.1h1.7 c0.4,0,0.9,0.2,1.2,0.5c0,0,0,0,0,0c0.4,0.3,0.5,0.7,0.5,1.2v18.7c0,0.4-0.2,0.8-0.5,1.1c0,0,0,0-0.1,0.1c-0.2,0.2-0.4,0.3-0.6,0.4 c-0.2,0.1-0.4,0.1-0.7,0.1H30.8z"}),(0,r.jsx)("path",{id:"loading-logo-r-shape-beneath",className:"opacity-30",d:"M34.8,70.7V41.5c0-0.3,0-0.6-0.1-0.8c-0.1-0.3-0.3-0.6-0.5-0.8 c-0.4-0.4-0.9-0.6-1.5-0.6c-0.1,0-0.1,0-0.2,0h-2.2v31.5h-7.5V1.1h11.7c2.1,0,4,0.8,5.5,2.2c0,0,0,0,0,0c1.5,1.4,2.3,3.3,2.3,5.3 c0,0,0,0.1,0,0.1v20.7c0,2.1-0.7,4.1-2,5.8l-0.1,0.2l0.1,0.1c1.3,1.7,2,3.7,2,5.9v29.2H34.8z M30.8,31.2V9.1h1.7 c0.4,0,0.9,0.2,1.2,0.5c0,0,0,0,0,0c0.4,0.3,0.5,0.7,0.5,1.2v18.7c0,0.4-0.2,0.8-0.5,1.1c0,0,0,0-0.1,0.1c-0.2,0.2-0.4,0.3-0.6,0.4 c-0.2,0.1-0.4,0.1-0.7,0.1H30.8z"})]})]})]})},a=function(){return(0,r.jsx)("div",{className:"w-full h-full flex flex-col justify-center items-center overflow-hidden animate-pulse",children:(0,r.jsx)(o,{className:"text-white flex-[0_0_80%]"})})}},2222:function(e,t,n){n.d(t,{Z:function(){return b}});var r=n(7568),o=n(1438),a=n(1799),s=n(9396),i=n(9815),u=n(655),c=n(5045),l=n(6531),d=n(8322),f=n.n(d);var h=n(5070),p=n(7942),v={TO_AAC:["-i","audio.file","-c:a","aac","-b:a","160k","output.m4a"],TO_MP3:["-i","audio.file","-vn","-ar","44100","-ac","2","-b:a","192k","output.mp3"],TO_WEBM:["-i","rawvisual.file","-c","vp9","-b:v","0","-crf","40","visual.webm"],TO_MP4:["-i","rawvisual.file","-movflags","+faststart","-pix_fmt","yuv420p","-vf","scale=trunc(iw/2)*2:trunc(ih/2)*2","visual.mp4"],TO_COPY_BUFFER:["-stream_loop","-1","-i","VFILE","-i","audio.file","-c:v","copy","-t","TIME","OUTPUT"]},b=function(){function e(t){var n=this;(0,o.Z)(this,e),this.isFullyInit=!1,this.needsToBeDestructed=!1,this.currentSound={},this.currentAppData={},this.audioContext=void 0,this.audioSourceInput=void 0,this.audioBufferInput=void 0,this.phaseVocoderProcessor=void 0,this.reverbProcessor=void 0,this.muffledProcessor=void 0,this.audioPosition=0,this.audioStartTime=0,this.audioIsPlaying=!1,this.ellipsedTime=0,this.afterInitData={setSoundsManagerStateCallback:t.setSoundsManagerStateCallback||function(){},setCurrentSoundCallback:t.setCurrentSoundCallback||function(){},setSoundReadyCallback:t.setSoundReadyCallback||function(){},setPlayStateCallback:t.setPlayStateCallback||function(){},setAppDataCallback:t.setAppDataCallback||function(){},setEncoderStateCallback:t.setEncoderStateCallback||function(){}},this.dbVersion=t.dbVersion,this.currentAppData=t.appData,this.asyncInit().catch((function(e){return n.afterInitData.setAppDataCallback({error:{type:"critical",value:e.message}})}));try{this.encoder=(0,c.createFFmpeg)(void 0),this.encoder.load().then((function(){return n.afterInitData.setEncoderStateCallback(p.w.LOADED)})).catch((function(e){n.afterInitData.setEncoderStateCallback(p.w.ERROR),n.afterInitData.setAppDataCallback({mediumModalText:"The video/audio encoder stumbled upon a problem during init.\n          You can still use the app but export options will be restricted.\n          (Error: ".concat(e.message,")")})}))}catch(r){this.afterInitData.setEncoderStateCallback(p.w.ERROR),this.afterInitData.setAppDataCallback({mediumModalText:"The video/audio encoder stumbled upon a problem during init.\n        You can still use the app but export options will be restricted.\n        (Error: ".concat(r.message,")")})}}var t=e.prototype;return t.asyncInit=function(){var e=this;return(0,r.Z)((function(){var t,r;return(0,u.__generator)(this,(function(o){switch(o.label){case 0:if(!("indexedDB"in window))throw new Error("Your browser doesn't seem to handle the database software, try to update it");if(!(t=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext||void 0))throw new Error("Your browser doesn't seem to handle the audio processing software, try to update it");o.label=1;case 1:return o.trys.push([1,3,,4]),[4,(0,l.X3)("sounds-manager-db",e.dbVersion||1,{upgrade:function(e){var t=e.createObjectStore("sounds-info",{autoIncrement:!0});t.createIndex("by-date","creationDate"),t.createIndex("by-audio-blob-key","blobAudioHash"),t.createIndex("by-visual-blob-key","blobVisualHash");var n=e.createObjectStore("sounds-temp-info",{autoIncrement:!0});n.createIndex("by-date","creationDate"),n.createIndex("by-audio-blob-key","blobAudioHash"),n.createIndex("by-visual-blob-key","blobVisualHash"),e.createObjectStore("sounds-source-blob",{keyPath:"hash"}),e.createObjectStore("sounds-visual-blob",{keyPath:"hash"})}})];case 2:return e.songsDb=o.sent(),[3,4];case 3:throw o.sent(),new Error("An error occured while setting up the sounds database, it may be because you're in private navigation or because your browser is too old");case 4:e.audioContext=new t,e.audioContext.suspend(),r=function e(){if(document.removeEventListener("touchstart",e),this.audioContext&&"closed"!==this.audioContext.state){var t=this.audioContext.createBufferSource();t.start(),t.stop()}}.bind(e),document.addEventListener("touchstart",r),o.label=5;case 5:return o.trys.push([5,8,,9]),[4,e.audioContext.audioWorklet.addModule("".concat(e.currentAppData.router.basePath,"/assets/js/phase-vocoder.min.js"))];case 6:return o.sent(),e.phaseVocoderProcessor=new AudioWorkletNode(e.audioContext,"phase-vocoder-processor"),[4,n.e(180).then(n.bind(n,5180))];case 7:return e.ReverbProcessor=o.sent().default,e.reverbProcessor=new e.ReverbProcessor(e.audioContext),e.muffledProcessor=e.audioContext.createBiquadFilter(),e.muffledProcessor.type="lowpass",e.muffledProcessor.frequency.setTargetAtTime(22050,0,0),[3,9];case 8:throw o.sent(),new Error("An error occured while setting up the audio processors, it may be because you're not on a secure connection (HTTPS) or because your browser is too old");case 9:return e.isFullyInit=!0,e.afterInitData.setSoundsManagerStateCallback(!0),e.needsToBeDestructed&&e.freeData(),[2]}}))}))()},t.freeData=function(){var e,t,n,r;this.isFullyInit=!1,null===(e=this.songsDb)||void 0===e||e.close(),null===(t=this.audioContext)||void 0===t||t.close(),(null===(n=this.encoder)||void 0===n?void 0:n.isLoaded())&&(null===(r=this.encoder)||void 0===r||r.exit()),this.afterInitData.setSoundReadyCallback(!1),this.afterInitData.setPlayStateCallback(!1),this.currentSound={},this.afterInitData.setCurrentSoundCallback({})},t.destructor=function(){this.needsToBeDestructed=!0,this.isFullyInit&&this.freeData()},t.closeDatabase=function(){var e;null===(e=this.songsDb)||void 0===e||e.close()},t.play=function(){var e,t;"running"!==(null===(e=this.audioContext)||void 0===e?void 0:e.state)&&(null===(t=this.audioContext)||void 0===t||t.resume()),this.setAudioSourceInput(),this.linkingProcesses(),this.audioStartTime=this.audioContext.currentTime,this.audioSourceInput.start(this.audioContext.currentTime,this.audioPosition),this.audioIsPlaying=!0,this.afterInitData.setPlayStateCallback(this.audioIsPlaying)},t.pause=function(){var e;this.audioSourceInput.stop(0),this.audioIsPlaying=!1,this.afterInitData.setPlayStateCallback(this.audioIsPlaying);var t=(this.audioContext.currentTime-this.audioStartTime)*((null===(e=this.currentSound.soundInfoData)||void 0===e?void 0:e.speedValue)||1);this.audioPosition=t+this.ellipsedTime,this.ellipsedTime=this.audioPosition},t.updateAudioPosition=function(e){var t;if(100===e&&(null===(t=this.audioSourceInput)||void 0===t?void 0:t.onended))this.audioSourceInput.onended({});else{var n=e/100*this.audioBufferInput.duration;this.ellipsedTime=n,this.audioPosition=n,this.audioIsPlaying&&this.play()}},t.cutAudio=function(){try{var e;null===(e=this.audioSourceInput)||void 0===e||e.disconnect(),this.audioIsPlaying=!1,this.afterInitData.setPlayStateCallback(this.audioIsPlaying),this.audioSourceInput&&(this.audioSourceInput.onended=null),this.audioSourceInput=void 0}catch(t){console.log(t.message)}},t.linkingProcesses=function(){this.reverbProcessor.connect(this.audioSourceInput).connect(this.phaseVocoderProcessor).connect(this.muffledProcessor).connect(this.audioContext.destination)},t.setAudioSourceInput=function(){var e,t=this;this.cutAudio(),this.audioSourceInput=this.audioContext.createBufferSource(),this.audioSourceInput.onended=function(){if(t.audioIsPlaying){try{t.audioSourceInput.stop(0)}catch(e){}t.audioIsPlaying=!1,t.afterInitData.setPlayStateCallback(t.audioIsPlaying),t.audioPosition=0,t.audioStartTime=0,t.ellipsedTime=0}},this.audioSourceInput.buffer=this.audioBufferInput,this.audioSourceInput.playbackRate.value=(null===(e=this.currentSound.soundInfoData)||void 0===e?void 0:e.speedValue)||1},t.getCurrentPercentage=function(){var e,t=(this.audioContext.currentTime-this.audioStartTime)*((null===(e=this.currentSound.soundInfoData)||void 0===e?void 0:e.speedValue)||1);return(this.audioIsPlaying?t+this.ellipsedTime:this.audioPosition)/this.audioBufferInput.duration},t.addFile=function(e,t,n){var o=this;return(0,r.Z)((function(){var r;return(0,u.__generator)(this,(function(a){switch(a.label){case 0:if(!o.isFullyInit)throw new Error("The audio context is not (yet) initialized...");return(r={}).soundInfoStore="sounds-temp-info",r.soundSourceData={data:e,type:n,hash:f().ArrayBuffer.hash(e)},r.soundInfoData={name:t||"Unknown title",author:"",blobAudioHash:r.soundSourceData.hash,blobVisualHash:"",creationDate:Date.now(),dontChangePitch:!1,speedValue:1,reverbEffectValue:0,lowKeyEffectValue:50},[4,o.songsDb.get("sounds-source-blob",r.soundSourceData.hash)];case 1:return a.sent()?[3,3]:[4,o.songsDb.add("sounds-source-blob",r.soundSourceData)];case 2:a.sent(),a.label=3;case 3:return[4,o.songsDb.add("sounds-temp-info",r.soundInfoData)];case 4:return r.soundInfoKey=a.sent(),[4,o.audioContext.decodeAudioData(e)];case 5:return o.audioBufferInput=a.sent(),r.soundBufferDuration=o.audioBufferInput.duration,o.currentSound=r,o.afterInitData.setCurrentSoundCallback(r),o.afterInitData.setSoundReadyCallback(!0),[2]}}))}))()},t.undraftCurrentSong=function(){var e=this;return(0,r.Z)((function(){var t,n,r,o,a;return(0,u.__generator)(this,(function(s){switch(s.label){case 0:return"sounds-temp-info"!==e.currentSound.soundInfoStore?[2]:(r=e.currentSound.soundInfoKey,o={},Object.assign(o,e.currentSound.soundInfoData||{}),o.creationDate=Date.now(),a=e.currentSound,[4,null===(t=e.songsDb)||void 0===t?void 0:t.add("sounds-info",o)]);case 1:return a.soundInfoKey=s.sent(),e.currentSound.soundInfoStore="sounds-info",r?[4,null===(n=e.songsDb)||void 0===n?void 0:n.delete("sounds-temp-info",r)]:[3,3];case 2:s.sent(),s.label=3;case 3:return[2]}}))}))()},t.exportSong=function(e){var t=this;return(0,r.Z)((function(){var n,r,o,a,s,i,c,l,d,f,h,p,v,b;return(0,u.__generator)(this,(function(u){switch(u.label){case 0:if(!t.isFullyInit||!(null===(n=t.encoder)||void 0===n?void 0:n.isLoaded))throw new Error("The audio context / encoder is not (yet) initialized...");if(!t.audioBufferInput)throw new Error("There is no song loaded to process");return l=new OfflineAudioContext({numberOfChannels:2,length:t.audioBufferInput.duration/((null===(r=t.currentSound.soundInfoData)||void 0===r?void 0:r.speedValue)||1)*44100,sampleRate:44100}),e({progress:.1,consoleEntry:{type:"normal",entry:"Offline audio context created"}}),[4,l.audioWorklet.addModule("/assets/js/phase-vocoder.min.js")];case 1:return u.sent(),(d=new AudioWorkletNode(l,"phase-vocoder-processor")).parameters.get("pitchFactor").value=(null===(o=t.currentSound.soundInfoData)||void 0===o?void 0:o.dontChangePitch)?1/((null===(a=t.currentSound.soundInfoData)||void 0===a?void 0:a.speedValue)||1):1,(f=new t.ReverbProcessor(l)).mix((null===(s=t.currentSound.soundInfoData)||void 0===s?void 0:s.speedValue)||0),(h=l.createBiquadFilter()).type="lowpass",h.frequency.setTargetAtTime(22050-((null===(i=t.currentSound.soundInfoData)||void 0===i?void 0:i.lowKeyEffectValue)||50)/100*22050,0,0),e({progress:.2,consoleEntry:{type:"normal",entry:"Audio processors configured"}}),(p=l.createBufferSource()).buffer=t.audioBufferInput,p.playbackRate.value=(null===(c=t.currentSound.soundInfoData)||void 0===c?void 0:c.speedValue)||1,f.connect(p).connect(d).connect(h).connect(l.destination),p.start(),e({progress:.3,consoleEntry:{type:"normal",entry:"Starting rendering... It could take some time"}}),[4,l.startRendering()];case 2:return v=u.sent(),e({progress:.6,consoleEntry:{type:"success",entry:"Rendering done"}}),e({progress:.7,consoleEntry:{type:"normal",entry:"Blobification..."}}),b=function(e,t){var n,r,o=function(e){c.setUint16(f,e,!0),f+=2},a=function(e){c.setUint32(f,e,!0),f+=4},s=e.numberOfChannels,i=t*s*2+44,u=new ArrayBuffer(i),c=new DataView(u),l=[],d=0,f=0;for(a(1179011410),a(i-8),a(1163280727),a(544501094),a(16),o(1),o(s),a(e.sampleRate),a(2*e.sampleRate*s),o(2*s),o(16),a(1635017060),a(i-f-4),n=0;n<e.numberOfChannels;n+=1)l.push(e.getChannelData(n));for(;f<i;){for(n=0;n<s;n+=1)r=0|(.5+(r=Math.max(-1,Math.min(1,l[n][d])))<0?32768*r:32767*r),c.setInt16(f,r,!0),f+=2;d+=1}return new Blob([u],{type:"audio/wav"})}(v,l.length),e({progress:1,consoleEntry:{type:"success",entry:"Raw edited song rendered"}}),[2,b]}}))}))()},t.encoderUtils=function(e,t,n){var o=this;return(0,r.Z)((function(){var r,a,s,c,l,d,f,p,b,g,m,x,y,w;return(0,u.__generator)(this,(function(u){switch(u.label){case 0:if(!o.isFullyInit||!(null===(r=o.encoder)||void 0===r?void 0:r.isLoaded))throw new Error("The audio context / encoder is not (yet) initialized...");switch(o.encoder.setLogger((function(e){var t=e.message;n({consoleEntry:{type:"normal",entry:t}})})),o.encoder.FS("writeFile","audio.file",new Uint8Array(e)),t!==h.T.TO_MP4&&t!==h.T.TO_WEBM||o.encoder.FS("writeFile","rawvisual.file",new Uint8Array(o.currentSound.visualSourceData.data)),a=[],s=(o.currentSound.soundBufferDuration||0)/(o.currentSound.soundInfoData.speedValue||1),c=Math.floor(s/3600),l=Math.floor(s/60-60*c),d=Math.floor(s-60*l),f="".concat(String(c).padStart(2,"0"),":").concat(String(l).padStart(2,"0"),":").concat(String(d).padStart(2,"0")),p=new Blob,t){case h.T.TO_AAC:return[3,1];case h.T.TO_MP3:return[3,3];case h.T.TO_MP4:return[3,5];case h.T.TO_WEBM:return[3,8]}return[3,11];case 1:return[4,(b=o.encoder).run.apply(b,(0,i.Z)(v.TO_AAC))];case 2:return u.sent(),p=new Blob([o.encoder.FS("readFile","output.m4a").buffer],{type:"audio/m4a"}),o.encoder.FS("unlink","output.m4a"),[3,12];case 3:return[4,(g=o.encoder).run.apply(g,(0,i.Z)(v.TO_MP3))];case 4:return u.sent(),p=new Blob([o.encoder.FS("readFile","output.mp3").buffer],{type:"audio/mpeg"}),o.encoder.FS("unlink","output.mp3"),[3,12];case 5:return[4,(m=o.encoder).run.apply(m,(0,i.Z)(v.TO_MP4))];case 6:return u.sent(),n({progress:.5}),(a=v.TO_COPY_BUFFER)[a.findIndex((function(e){return"TIME"===e}))]=f,a[a.findIndex((function(e){return"VFILE"===e}))]="visual.mp4",a[a.findIndex((function(e){return"OUTPUT"===e}))]="output.mp4",[4,(x=o.encoder).run.apply(x,(0,i.Z)(a))];case 7:return u.sent(),p=new Blob([o.encoder.FS("readFile","output.mp4").buffer],{type:"video/mp4"}),o.encoder.FS("unlink","output.mp4"),o.encoder.FS("unlink","visual.mp4"),[3,12];case 8:return[4,(y=o.encoder).run.apply(y,(0,i.Z)(v.TO_WEBM))];case 9:return u.sent(),n({progress:.5}),(a=v.TO_COPY_BUFFER)[a.findIndex((function(e){return"TIME"===e}))]=f,a[a.findIndex((function(e){return"VFILE"===e}))]="visual.webm",a[a.findIndex((function(e){return"OUTPUT"===e}))]="output.webm",[4,(w=o.encoder).run.apply(w,(0,i.Z)(a))];case 10:return u.sent(),p=new Blob([o.encoder.FS("readFile","output.webm").buffer],{type:"video/webm"}),o.encoder.FS("unlink","output.webm"),o.encoder.FS("unlink","visual.webm"),[3,12];case 11:return[3,12];case 12:return n({progress:1}),o.encoder.FS("unlink","audio.file"),t!==h.T.TO_MP4&&t!==h.T.TO_WEBM||o.encoder.FS("unlink","rawvisual.file"),[2,p]}}))}))()},t.resetCurrentSound=function(){var e,t,n,r;this.isFullyInit&&(this.currentSound={},this.afterInitData.setCurrentSoundCallback({}),this.afterInitData.setSoundReadyCallback(!1),this.audioBufferInput=void 0,this.audioPosition=0,this.audioStartTime=0,this.ellipsedTime=0,null===(e=this.reverbProcessor)||void 0===e||e.mix(0),null===(t=this.muffledProcessor)||void 0===t||t.frequency.setTargetAtTime(22050,0,0),"running"===(null===(n=this.audioContext)||void 0===n?void 0:n.state)&&(null===(r=this.audioContext)||void 0===r||r.suspend()))},t.updateCurrentSound=function(e){var t=this;return(0,r.Z)((function(){var n;return(0,u.__generator)(this,(function(r){switch(r.label){case 0:if(!t.isFullyInit)throw new Error("The audio context is not (yet) initialized...");return t.currentSound.soundInfoStore&&t.currentSound.soundInfoKey?(n=t.currentSound.soundInfoData||{},Object.assign(n,e),[4,t.songsDb.put(t.currentSound.soundInfoStore,n,t.currentSound.soundInfoKey)]):[2];case 1:return r.sent(),t.currentSound.soundInfoData=n,t.afterInitData.setCurrentSoundCallback((0,s.Z)((0,a.Z)({},t.currentSound),{soundInfoData:n})),t.phaseVocoderProcessor&&void 0!==e.dontChangePitch&&(t.phaseVocoderProcessor.parameters.get("pitchFactor").value=e.dontChangePitch&&n.speedValue?1/n.speedValue:1),[2]}}))}))()},t.updateVisualSource=function(e,t){var n=this;return(0,r.Z)((function(){var r,o,i;return(0,u.__generator)(this,(function(u){switch(u.label){case 0:if(!n.isFullyInit)throw new Error("The database is not (yet) initialized...");return n.currentSound.soundInfoStore&&n.currentSound.soundInfoKey?(o=f().ArrayBuffer.hash(e),(i=null===(r=n.currentSound.soundInfoData)||void 0===r?void 0:r.blobVisualHash)?[4,n.songsDb.getAllFromIndex("sounds-info","by-visual-blob-key",n.currentSound.soundInfoData.blobVisualHash)]:[3,2]):[2];case 1:i=u.sent().length<2,u.label=2;case 2:return i?[4,n.songsDb.delete("sounds-visual-blob",n.currentSound.soundInfoData.blobVisualHash)]:[3,4];case 3:u.sent(),u.label=4;case 4:return[4,n.songsDb.get("sounds-visual-blob",o)];case 5:return u.sent()?[3,7]:[4,n.songsDb.add("sounds-visual-blob",{data:e,type:t,hash:o})];case 6:u.sent(),u.label=7;case 7:return n.currentSound.visualSourceData={data:e,type:t,hash:o},n.afterInitData.setCurrentSoundCallback((0,s.Z)((0,a.Z)({},n.currentSound),{visualSourceData:{data:e,type:t,hash:o}})),[4,n.updateCurrentSound({blobVisualHash:o})];case 8:return u.sent(),[2]}}))}))()},t.deleteCurrentSound=function(){var e=this;return(0,r.Z)((function(){var t,n,r,o;return(0,u.__generator)(this,(function(a){switch(a.label){case 0:if(!e.isFullyInit)throw new Error("The database is not (yet) initialized...");return e.currentSound.soundInfoData&&e.currentSound.soundInfoKey?(r=null===(t=e.currentSound.soundInfoData)||void 0===t?void 0:t.blobVisualHash)?[4,e.songsDb.getAllFromIndex("sounds-info","by-visual-blob-key",e.currentSound.soundInfoData.blobVisualHash)]:[3,2]:[2];case 1:r=a.sent().length<2,a.label=2;case 2:return r?[4,e.songsDb.delete("sounds-visual-blob",e.currentSound.soundInfoData.blobVisualHash)]:[3,4];case 3:a.sent(),a.label=4;case 4:return(o=null===(n=e.currentSound.soundInfoData)||void 0===n?void 0:n.blobAudioHash)?[4,e.songsDb.getAllFromIndex("sounds-info","by-audio-blob-key",e.currentSound.soundInfoData.blobAudioHash)]:[3,6];case 5:o=a.sent().length<2,a.label=6;case 6:return o?[4,e.songsDb.delete("sounds-source-blob",e.currentSound.soundInfoData.blobAudioHash)]:[3,8];case 7:a.sent(),a.label=8;case 8:return[4,e.songsDb.delete("sounds-info",e.currentSound.soundInfoKey)];case 9:return a.sent(),e.currentSound={},e.afterInitData.setCurrentSoundCallback({}),[2]}}))}))()},t.tweakDataCurrentSound=function(t,n,o){var a=this;return(0,r.Z)((function(){var r,s,i,c,l,d;return(0,u.__generator)(this,(function(u){switch(u.label){case 0:switch(s=e.valueConverter(t,n,!0),i=(null===(r=a.currentSound.soundInfoData)||void 0===r?void 0:r.speedValue)||1,t){case"speed":return[3,1];case"reverb":return[3,4];case"distance":return[3,7]}return[3,10];case 1:return o&&o.noDatabaseUpdate?[3,3]:[4,a.updateCurrentSound({speedValue:s})];case 2:u.sent(),u.label=3;case 3:return o&&o.noPlaybackValueUpdate?[2]:(a.audioIsPlaying&&(a.ellipsedTime+=(a.audioContext.currentTime-a.audioStartTime)*i,a.audioStartTime=a.audioContext.currentTime),a.audioSourceInput&&(a.audioSourceInput.playbackRate.value=s),a.phaseVocoderProcessor&&(a.phaseVocoderProcessor.parameters.get("pitchFactor").value=(null===(c=a.currentSound.soundInfoData)||void 0===c?void 0:c.dontChangePitch)?1/s:1),[3,11]);case 4:return o&&o.noDatabaseUpdate?[3,6]:[4,a.updateCurrentSound({reverbEffectValue:s})];case 5:u.sent(),u.label=6;case 6:return o&&o.noPlaybackValueUpdate||null===(l=a.reverbProcessor)||void 0===l||l.mix(s),[3,11];case 7:return o&&o.noDatabaseUpdate?[3,9]:[4,a.updateCurrentSound({lowKeyEffectValue:s})];case 8:u.sent(),u.label=9;case 9:return o&&o.noPlaybackValueUpdate||null===(d=a.muffledProcessor)||void 0===d||d.frequency.setTargetAtTime(22050-s/100*22050,0,0),[3,11];case 10:return[3,11];case 11:return[2]}}))}))()},t.injectInCurrentSong=function(e,t,n,o){var a=this;return(0,r.Z)((function(){var r,s,i,c,l,d,f,h,p,v;return(0,u.__generator)(this,(function(u){switch(u.label){case 0:if(!a.isFullyInit)throw new Error("The audio context is not (yet) initialized...");return r={},Object.assign(r,a.currentSound),o&&o.soundInfoKey||(r.soundInfoKey=t),o&&o.soundInfoStore||(r.soundInfoStore=e),o&&o.soundInfoData?[3,2]:[4,null===(s=a.songsDb)||void 0===s?void 0:s.get(e,t)];case 1:if(r.soundInfoData=u.sent(),!r.soundInfoData)throw new Error("The given song id seems to be incorrect");u.label=2;case 2:return o&&o.soundSourceData?[3,4]:[4,null===(i=a.songsDb)||void 0===i?void 0:i.get("sounds-source-blob",(null===(c=r.soundInfoData)||void 0===c?void 0:c.blobAudioHash)||"")];case 3:if(r.soundSourceData=u.sent(),!r.soundSourceData)throw new Error("Error while fetching song blob");u.label=4;case 4:return o&&o.visualSourceData?[3,6]:[4,null===(l=a.songsDb)||void 0===l?void 0:l.get("sounds-visual-blob",(null===(d=r.soundInfoData)||void 0===d?void 0:d.blobVisualHash)||"")];case 5:if(r.visualSourceData=u.sent(),!r.visualSourceData)throw new Error("Error while fetching visual blob");u.label=6;case 6:return n?[4,a.audioContext.decodeAudioData(null===(f=r.soundSourceData)||void 0===f?void 0:f.data)]:[3,8];case 7:a.audioBufferInput=u.sent(),r.soundBufferDuration=a.audioBufferInput.duration,null===(h=a.muffledProcessor)||void 0===h||h.frequency.setTargetAtTime(22050-r.soundInfoData.lowKeyEffectValue/100*22050,0,0),null===(p=a.reverbProcessor)||void 0===p||p.mix(null===(v=r.soundInfoData)||void 0===v?void 0:v.reverbEffectValue),a.afterInitData.setSoundReadyCallback(!0),u.label=8;case 8:return a.afterInitData.setCurrentSoundCallback(r),a.currentSound=r,[2]}}))}))()},t.contextUpdateCurrentSound=function(e){this.currentSound=e},t.contextUpdateCurrentAppData=function(e){this.currentAppData=e},t.getAllFromIndex=function(e,t,n){var o=this;return(0,r.Z)((function(){var r,a;return(0,u.__generator)(this,(function(s){switch(s.label){case 0:if(!o.songsDb)throw new Error("The database is still loading or had issues to load");return[4,o.songsDb.getAllFromIndex(e,t)];case 1:return r=s.sent(),[4,o.songsDb.getAllKeysFromIndex(e,t)];case 2:return a=s.sent(),n&&(r.reverse(),a.reverse()),[2,[r,a]]}}))}))()},e.valueConverter=function(e,t,n){var r=0;switch(e){case"speed":(r=n?t/50:t)<1&&(r=n?.75*r+.25:(r-.25)/.75),n||(r*=50);break;case"reverb":r=n?t/100:100*t;break;case"distance":r=n?50+Math.min(t,99)/2:2*(t-50)}return r},e}()},7299:function(e,t,n){n.d(t,{B:function(){return u}});var r=n(5893),o=n(7294),a=n(7942),s=n(2222),i=n(1108),u=(0,o.createContext)({});t.Z=function(e){var t=(0,o.useState)(!1),n=t[0],c=t[1],l=(0,o.useState)(!1),d=l[0],f=l[1],h=(0,o.useState)(a.w.LOADING),p=h[0],v=h[1],b=(0,o.useState)(!1),g=b[0],m=b[1],x=(0,o.useState)({}),y=x[0],w=x[1],S=(0,o.useState)(),I=S[0],D=S[1],C=(0,o.useContext)(i.R),k=C.appData,P=C.setAppData;return(0,o.useEffect)((function(){var e=new s.Z({setSoundsManagerStateCallback:c,setCurrentSoundCallback:w,setSoundReadyCallback:f,setPlayStateCallback:m,setAppDataCallback:P,setEncoderStateCallback:v,appData:k});return e.resetCurrentSound(),D(e),function(){return e.destructor()}}),[]),(0,o.useEffect)((function(){null===I||void 0===I||I.contextUpdateCurrentSound(y)}),[y,I]),(0,o.useEffect)((function(){k&&(null===I||void 0===I||I.contextUpdateCurrentAppData(k))}),[k]),(0,r.jsx)(u.Provider,{value:{isSoundsManagerInit:n,isCurrentSoundReady:d,playState:g,soundsManager:I,currentSound:y,encoderState:p},children:e.children})}},5070:function(e,t,n){var r;n.d(t,{T:function(){return r}}),function(e){e[e.NO_CHOICE=0]="NO_CHOICE",e[e.TO_RAW_AUDIO=1]="TO_RAW_AUDIO",e[e.TO_MP3=2]="TO_MP3",e[e.TO_AAC=3]="TO_AAC",e[e.TO_WEBM=4]="TO_WEBM",e[e.TO_MP4=5]="TO_MP4"}(r||(r={}))},7942:function(e,t,n){var r,o;n.d(t,{w:function(){return o}}),function(e){e[e.UNINITIALIZE=0]="UNINITIALIZE",e[e.INITIALIZE=1]="INITIALIZE",e[e.ENDED=2]="ENDED"}(r||(r={})),function(e){e[e.LOADING=0]="LOADING",e[e.LOADED=1]="LOADED",e[e.ERROR=2]="ERROR"}(o||(o={}))},1446:function(e,t,n){var r=n(1799),o=n(7294),a={showStaticCanvas:!0,backgroundColor:"slate"};t.Z=function(){var e=(0,o.useState)(JSON.parse(localStorage.getItem("srConfig")||"null")||a),t=e[0],n=e[1],s=(0,o.useCallback)((function(e){var n=(0,r.Z)({},t);Object.assign(n,e),localStorage.setItem("srConfig",JSON.stringify(n)),window.dispatchEvent(new Event("storage"))}),[t]);return(0,o.useEffect)((function(){var e=function(){n(JSON.parse(localStorage.getItem("srConfig")||"null")||a)};return window.addEventListener("storage",e),function(){return window.removeEventListener("storage",e)}}),[]),[t,s]}},5835:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(7294),o=n(1799);var a=function(){var e=(0,r.useState)({width:void 0,height:void 0}),t=e[0],n=e[1];return(0,r.useEffect)((function(){var e=function(e,t,n){var r;return function(){clearTimeout(r),r=setTimeout((function(){r=void 0,e((0,o.Z)({},n))}),t)}}((function(){n({width:window.innerWidth,height:window.innerHeight})}),500);return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}),[]),t}}}]);